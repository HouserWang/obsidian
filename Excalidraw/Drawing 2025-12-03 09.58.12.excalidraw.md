---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'


# Excalidraw Data

## Text Elements
redis相关 ^5yRRacjg

list里lrang和rpush实现分页 ^zDbRXy7x

冷热分离 ^y0VaP0yH

锁 ^Vu9cMHsv

锁的通用设计模式：Monitor（监视器）模式
              synchronized         AQS
互斥锁       对象头+owner        state+cas当前线程
等待队列     entryList            clh
条件队列     waitset              conditionObject单链表
 ^1lTXqNgR

缓存技术方案选择
库存系统:
  - 并发低(<500QPS): 数据库乐观锁
  - 并发中(500-5000QPS): Redis预扣 + 异步更新
  - 并发高(>5000QPS): Redis分段库存 + 消息队列

缓存策略:
  - 读多写少: Cache Aside + 过期时间
  - 写多读少: Write Through/Behind
  - 一致性要求高: 延迟双删
  - 一致性要求极高: 不用缓存

 ^Omnn1CTf

缓存预热 ^zKATlW4P

穿透：查询不存在的数据，导致每次都要查数据库。解决方法：缓存空值，使用布隆过滤器。

击穿：热点key过期，大量请求同时打到数据库。解决方法：加锁（分布式锁或本地锁）只让一个请求去查数据库，其他等待。

雪崩：大量key同时过期。解决方法：设置不同的过期时间（比如基础时间加上随机时间） ^CgKhB4QF

%%
## Drawing
```compressed-json
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=
```
%%